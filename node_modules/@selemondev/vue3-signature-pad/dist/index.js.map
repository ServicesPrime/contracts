{"version":3,"sources":["../src/components/Users/selemondev/Desktop/vue3-signature-pad/src/components/VueSignaturePad.vue"],"sourcesContent":["<!-- eslint-disable ts/ban-ts-comment -->\n<!-- eslint-disable ts/no-unused-expressions -->\n<script setup lang='ts'>\nimport type { CanvasOptions, Point, Props, Signature, WaterMarkObj } from '../types'\nimport { nanoid } from 'nanoid'\nimport SignaturePad from 'signature_pad'\nimport { onBeforeUnmount, onMounted, ref, watch, watchEffect } from 'vue'\n\ndefineOptions({\n  name: 'VueSignaturePad',\n  inheritAttrs: false,\n})\n\nconst props = withDefaults(defineProps<Props>(), {\n  throttle: 16,\n  minWidth: 5,\n  maxWidth: 5,\n  height: '100%',\n  width: '100%',\n  option: {\n    backgroundColor: 'rgb(255,255,255)',\n    penColor: 'rgb(0, 0, 0)',\n  },\n  disabled: false,\n  clearOnResize: false,\n  defaultUrl: '',\n})\n\nconst emits = defineEmits<{\n  (e: 'beginStroke', val: string): void\n  (e: 'endStroke', val: string): void\n  (e: 'beforeUpdateStroke', val: string): void\n  (e: 'afterUpdateStroke', val: string): void\n}>()\n\nconst canvasOptions = ref<CanvasOptions>({\n  signaturePad: {} as Signature,\n  dotSize: 0.5,\n  minWidth: 2,\n  maxWidth: 2,\n  throttle: 16,\n  backgroundColor: props.options.backgroundColor,\n  penColor: props.options.penColor,\n  canvasUuid: `canvas${nanoid()}`,\n})\n\nfunction isCanvasEmpty(): boolean {\n  return canvasOptions.value.signaturePad.isEmpty()\n}\n\nfunction saveSignature(format?: string): string {\n  return format ? canvasOptions.value.signaturePad.toDataURL(format) : canvasOptions.value.signaturePad.toDataURL()\n}\n\nfunction clearCanvas() {\n  return canvasOptions.value.signaturePad.clear()\n}\n\nconst canvas = document.getElementById(canvasOptions.value.canvasUuid) as HTMLCanvasElement\n\nfunction fromDataURL(url: string) {\n  return canvasOptions.value.signaturePad.fromDataURL(url)\n}\n\nfunction undo() {\n  const canvasData: Point[][] = canvasOptions.value.signaturePad.toData()\n  if (canvasData.length) {\n    canvasData.pop()\n    canvasOptions.value.signaturePad.fromData(canvasData)\n  }\n};\n\nfunction addWaterMark(data: WaterMarkObj) {\n  if (!(Object.prototype.toString.call(data) === '[object Object]')) {\n    throw new Error(`Expected Object, got ${typeof data}.`)\n  }\n  else {\n    const textData = {\n      text: data.text || '',\n      x: data.x || 20,\n      y: data.y || 20,\n      sx: data.sx || 40,\n      sy: data.sy || 40,\n    }\n    const VCanvas = document.getElementById(canvasOptions.value.canvasUuid) as HTMLCanvasElement\n    const ctx = VCanvas.getContext('2d')\n    if (ctx) {\n      ctx.font = data.font || '20px sans-serif'\n      ctx.fillStyle = data.fillStyle || '#333'\n      ctx.strokeStyle = data.strokeStyle || '#333'\n      if (data.style === 'all') {\n        ctx.fillText(textData.text, textData.x, textData.y)\n\n        ctx.strokeText(textData.text, textData.sx, textData.sy)\n      }\n      else if (data.style === 'stroke') {\n        ctx.strokeText(textData.text, textData.sx, textData.sy)\n      }\n      else {\n        ctx.fillText(textData.text, textData.x, textData.y)\n      }\n    }\n    canvasOptions.value.signaturePad._isEmpty = false\n  }\n}\n\nfunction resizeCanvas(c: HTMLCanvasElement) {\n  let url\n  if (!isCanvasEmpty()) {\n    url = saveSignature()\n  }\n  const ratio = Math.max(window.devicePixelRatio || 1, 1)\n  const reg = /px/\n  c.width = props.width && reg.test(props?.width) ? Number.parseInt(props?.width.replace(/px/g, '')) * ratio : c.offsetWidth * ratio\n  c.height = props.height && reg.test(props?.height) ? Number.parseInt(props?.height.replace(/px/g, '')) * ratio : c.offsetHeight * ratio\n  c.getContext('2d')?.scale(ratio, ratio)\n  clearCanvas()\n  !props.clearOnResize && url !== undefined && fromDataURL(url)\n  props.waterMark && Object.keys(props.waterMark).length && addWaterMark(props.waterMark)\n}\n\nfunction handleBeginStroke() {\n  return canvasOptions.value.signaturePad.addEventListener('beginStroke', () => {\n    emits('beginStroke', 'Signature started')\n  })\n}\n\nfunction handleEndStroke() {\n  return canvasOptions.value.signaturePad.addEventListener('endStroke', () => {\n    emits('endStroke', 'Signature ended')\n  })\n}\n\nfunction handleBeforeUpdateStroke() {\n  return canvasOptions.value.signaturePad.addEventListener('beforeUpdateStroke', () => {\n    emits('beforeUpdateStroke', 'Signature before update')\n  })\n}\n\nfunction handleAfterUpdateStroke() {\n  return canvasOptions.value.signaturePad.addEventListener('afterUpdateStroke', () => {\n    emits('afterUpdateStroke', 'Signature after update')\n  })\n}\nfunction draw() {\n  const canvas = document.getElementById(canvasOptions.value.canvasUuid) as HTMLCanvasElement\n  if (!canvas) {\n    throw new Error(`Canvas element with ID ${canvasOptions.value.canvasUuid} not found.`)\n  };\n  // @ts-expect-error\n  canvasOptions.value.signaturePad = new SignaturePad(canvas, canvasOptions.value)\n  handleBeginStroke()\n  handleEndStroke()\n  handleBeforeUpdateStroke()\n  handleAfterUpdateStroke()\n  const resizeHandler = () => {\n    resizeCanvas(canvas)\n  }\n  window.addEventListener('resize', resizeHandler)\n  resizeCanvas(canvas)\n  if (props.defaultUrl !== '') {\n    fromDataURL(props.defaultUrl)\n  }\n  if (props.disabled) {\n    canvasOptions.value.signaturePad.off()\n  }\n  else {\n    canvasOptions.value.signaturePad.on()\n  }\n}\n\nwatchEffect(() => {\n  // Update penColor\n  canvasOptions.value.penColor = props.options.penColor\n  canvasOptions.value.signaturePad.penColor = props.options.penColor\n  // Update backgroundColor\n  canvasOptions.value.backgroundColor = props.options.backgroundColor\n  canvasOptions.value.signaturePad.backgroundColor = props.options.backgroundColor\n})\n\nwatch(() => props.minWidth, (newVal) => {\n  if (newVal) {\n    canvasOptions.value.minWidth = newVal\n    canvasOptions.value.signaturePad.minWidth = newVal\n  }\n}, { immediate: true })\n\nwatch(() => props.maxWidth, (newVal) => {\n  if (newVal) {\n    canvasOptions.value.maxWidth = newVal\n    canvasOptions.value.signaturePad.maxWidth = newVal\n  }\n}, { immediate: true })\n\nwatch(\n  () => props.disabled,\n  (val) => {\n    if (val) {\n      return canvasOptions.value.signaturePad.off()\n    }\n    else {\n      return canvasOptions.value.signaturePad.on()\n    }\n  },\n)\ndefineExpose({\n  saveSignature,\n  clearCanvas,\n  addWaterMark,\n  isCanvasEmpty,\n  fromDataURL,\n  undo,\n})\n\nonMounted(() => {\n  draw()\n})\n\nonBeforeUnmount(() => {\n  const resizeHandler = () => {\n    resizeCanvas(canvas)\n  }\n  window.removeEventListener('resize', resizeHandler)\n})\n</script>\n\n<template>\n  <div :style=\"{ width: props.width, height: props.height }\" @touchmove.prevent>\n    <canvas\n      :id=\"canvasOptions.canvasUuid\" style=\"width: 100%; height: 100%;\"\n      :data-uid=\"canvasOptions.canvasUuid\"\n    />\n  </div>\n</template>\n"],"mappings":"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","names":["canvas"]}